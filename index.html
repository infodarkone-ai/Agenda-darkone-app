<!DOCTYPE html>
<html lang="es">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Agenda Citas Dark One (App Standalone)</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <style>
Â  Â  Â  Â  /* Estilos base para el tema Dark One (Negro, Gris Oscuro y Rojo Magenta) */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --color-primary: #e11d48; /* Rojo Magenta (nuevo acento) */
Â  Â  Â  Â  Â  Â  --color-secondary: #1e1e1e; /* Gris oscuro (cards) */
Â  Â  Â  Â  Â  Â  --color-background: #121212; /* Fondo general (Negro muy oscuro) */
Â  Â  Â  Â  Â  Â  --color-input-bg: #2a2a2a; /* Inputs background */
Â  Â  Â  Â  Â  Â  --color-input-border: #3a3a3a; /* Bordes suaves */
Â  Â  Â  Â  Â  Â  --color-text: #e5e5e5; /* Texto principal */
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: var(--color-background);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Asegura el contraste de los iconos de fecha/hora en inputs */
Â  Â  Â  Â  .dark-input[type="date"]::-webkit-calendar-picker-indicator,
Â  Â  Â  Â  .dark-input[type="time"]::-webkit-calendar-picker-indicator {
Â  Â  Â  Â  Â  Â  filter: invert(1);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Clases base del formulario */
Â  Â  Â  Â  .dark-card {
Â  Â  Â  Â  Â  Â  background-color: var(--color-secondary);
Â  Â  Â  Â  Â  Â  border: 1px solid #3a3a3a; /* Nuevo borde */
Â  Â  Â  Â  Â  Â  box-shadow: 0 6px 12px -2px rgba(0, 0, 0, 0.6); /* Sombra mÃ¡s dark */
Â  Â  Â  Â  Â  Â  border-radius: 1rem;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-input, .dark-textarea, .dark-select {
Â  Â  Â  Â  Â  Â  background-color: var(--color-input-bg); /* Nuevo fondo input */
Â  Â  Â  Â  Â  Â  border-color: var(--color-input-border); /* Nuevo borde input */
Â  Â  Â  Â  Â  Â  color: var(--color-text);
Â  Â  Â  Â  Â  Â  padding: 0.75rem;Â 
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;Â 
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dark-input:focus, .dark-textarea:focus, .dark-select:focus {
Â  Â  Â  Â  Â  Â  border-color: var(--color-primary);
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 2px var(--color-primary);
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Estilo para los enlaces con apariencia de botÃ³n utilitario (verde) */
Â  Â  Â  Â  .whatsapp-util-button {
Â  Â  Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  font-size: 0.875rem;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  Â  Â  background-color: #22c55e; /* Verde WhatsApp */
Â  Â  Â  Â  Â  Â  padding: 0.5rem 0.75rem;
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  transition: all 0.15s;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .whatsapp-util-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #16a34a; /* Verde mÃ¡s oscuro */
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="bg-[#121212] min-h-screen p-4 sm:p-8">

Â  Â  <div class="max-w-4xl mx-auto">
Â  Â  Â  Â  <header class="text-center mb-8 p-4 dark-card border-b-4 border-[#e11d48]"> Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-extrabold text-[#e11d48]">Agenda Citas Dark One</h1> Â  Â  Â  Â  Â  Â  <p class="text-[#e5e5e5] text-sm">Sistema para agendar citas, generar mensajes y compartir enlaces.</p> Â  Â  Â  Â  </header>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <form id="appointmentForm" class="dark-card p-6 sm:p-8 shadow-2xl space-y-6">
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-[#e5e5e5] border-b border-[#3a3a3a] pb-3">Detalles de la Cita</h2> Â  Â  Â  Â  Â  Â  <div class="grid md:grid-cols-3 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-[#e5e5e5] mb-1">Nombre Cliente <span class="text-[#e11d48]">*</span></label> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="clientName" placeholder="Nombre Completo" class="w-full dark-input shadow-sm" required value="">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-[#e5e5e5] mb-1">Servicio <span class="text-[#e11d48]">*</span></label> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="serviceType" class="w-full dark-select shadow-sm" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Tatuaje">Tatuaje</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Piercing">Piercing</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Tratamiento Granuloma">Tratamiento Granuloma</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Piercing Menor de Edad">Piercing Menor de Edad</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Reserva de Retoques">Reserva de Retoques</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-[#e5e5e5] mb-1">WhatsApp (Incluir prefijo) <span class="text-[#e11d48]">*</span></label> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" id="clientPhone" placeholder="+56912345678" class="w-full dark-input shadow-sm" required value="+569">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="grid md:grid-cols-3 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-[#e5e5e5] mb-1">Correo Cliente <span class="text-[#e11d48]">*</span></label> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="clientEmail" placeholder="correo" class="w-full dark-input shadow-sm pr-24" required value="">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="absolute right-0 top-0 mt-3 mr-3 text-gray-500 pointer-events-none">@gmail.com</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-[#e5e5e5] mb-1">Abono (CLP$)</label> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="abono" placeholder="Ej: 50000" class="w-full dark-input shadow-sm" value="">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-[#e5e5e5] mb-1">DescripciÃ³n / Notas EspecÃ­ficas (Se aÃ±ade a Calendar)</label> Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="description" placeholder="Ej: DiseÃ±o de dragÃ³n en hombro. Medidas 15x10cm." class="w-full dark-textarea shadow-sm" rows="3"></textarea>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-[#e5e5e5] border-b border-[#3a3a3a] pb-3 pt-4">Fecha y Horario</h2> Â  Â  Â  Â  Â  Â  <div class="grid md:grid-cols-3 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-[#e5e5e5] mb-1">Fecha <span class="text-[#e11d48]">*</span></label> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="appointmentDate" class="w-full dark-input dark-input shadow-sm" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-[#e5e5e5] mb-1">Hora de Inicio (15:00 por defecto) <span class="text-[#e11d48]">*</span></label> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="time" id="appointmentStartTime" class="w-full dark-input dark-input shadow-sm" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-[#e5e5e5] mb-1">Hora de TÃ©rmino (30 min) <span class="text-[#e11d48]">*</span></label> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="time" id="appointmentEndTime" class="w-full dark-input dark-input shadow-sm" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button type="submit" class="w-full flex justify-center items-center py-3 px-4 rounded-lg shadow-md text-lg font-medium text-white transition duration-200 bg-[#e11d48] hover:bg-[#be123c] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#e11d48] focus:ring-offset-[#121212]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-white"><path d="M8 2v4"/><path d="M16 2v4"/><path d="M21 21H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h18a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2z"/><path d="M3 11h18"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  GENERAR MENSAJE Y ENLACES
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </form>

Â  Â  Â  Â  <div id="outputContainer" class="mt-8 dark-card p-6 sm:p-8 shadow-2xl hidden">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="statusMessage" class="mb-4 p-3 rounded-lg flex items-center hidden"></div>

Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-[#e11d48] mb-4 flex items-center"> Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 text-[#e11d48]"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg> Â  Â  Â  Â  Â  Â  Â  Â  Acciones Finales y Vista Previa
Â  Â  Â  Â  Â  Â  </h2>

Â  Â  Â  Â  Â  Â  <div class="space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-[#1e1e1e] p-4 rounded-lg border border-[#e11d48]/50"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-semibold text-[#e11d48] mb-2 flex items-center"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1 text-[#e11d48]"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  URL de Google Calendar (Copiada automÃ¡ticamente - Target: <b><span id="calendarTargetName"></span></b>)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-[#e5e5e5] mb-3">La descripciÃ³n de Calendar ahora contiene el texto con los datos del cliente y los *detalles del servicio*.</p> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="debugUrlOutput" class="w-full dark-textarea shadow-sm text-xs" rows="3" readonly></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="copyUrlButton" onclick="copyToClipboard('debugUrlOutput', 'URL de Calendar')" class="mt-3 inline-flex items-center text-sm font-semibold text-white bg-red-400 hover:bg-red-500 px-3 py-1.5 rounded-lg transition duration-150">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-white"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Copiar URL de Calendar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-[#1e1e1e] p-4 rounded-lg border border-[#3a3a3a]"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg font-semibold text-[#e5e5e5] mb-3 flex items-center"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-[#e11d48]"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Mensaje Final de WhatsApp (Vista Previa)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <pre id="resumenTexto" class="whitespace-pre-wrap p-4 text-xs font-mono text-[#e5e5e5] bg-[#121212] rounded border border-[#3a3a3a] overflow-auto"></pre> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 flex flex-wrap gap-3 items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="copyButton" onclick="copyToClipboard('resumenTexto', 'Mensaje de WhatsApp')" class="inline-flex items-center text-sm font-semibold text-white bg-[#e11d48] hover:bg-[#be123c] px-3 py-1.5 rounded-lg transition duration-150">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 text-white"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Copiar Mensaje
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a id="whatsappLink" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-sm font-semibold text-white bg-green-500 hover:bg-green-600 px-3 py-1.5 rounded-lg transition duration-150">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Abrir WhatsApp Web
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-sm font-bold text-[#e5e5e5] mt-6 mb-2">Enlaces RÃ¡pidos para Cliente:</h3> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a id="reviewLink" target="_blank" rel="noopener noreferrer" class="whatsapp-util-button bg-red-500 hover:bg-red-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M12 17.5V10"/><path d="M14 13.5l-2 2-2-2"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Compartir Link de ReseÃ±as
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a id="cuidadosLink" target="_blank" rel="noopener noreferrer" class="whatsapp-util-button">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M15 2H9a3 3 0 0 0-3 3v14a3 3 0 0 0 3 3h6a3 3 0 0 0 3-3V5a3 3 0 0 0-3-3Z"/><path d="M12 18h.01"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Compartir Link de Cuidados
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // --- CONSTANTES Y CONFIGURACIÃ“N ---
Â  Â  Â  Â  const $ = id => document.getElementById(id);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ConfiguraciÃ³n de Calendar
Â  Â  Â  Â  const CALENDAR_LOCATION = 'DARK ONE / TATUAJES & PIERCINGS'; // UbicaciÃ³n Solicitada
Â  Â  Â  Â  // IDs de calendario (src) para Calendar
Â  Â  Â  Â  const TATUAJE_CALENDAR_SRC = 'Citas WEBTatuajes';Â 
Â  Â  Â  Â  const PIERCING_CALENDAR_SRC = 'Citas WEBPiercing';Â 
Â  Â  Â  Â  const TIMEZONE_CTZ = 'America/Santiago'; // Zona horaria de Chile/SantiagoÂ 
Â  Â  Â  Â  const REMINDER_MINUTES = 180; // 3 Horas antes (3 * 60)
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Enlaces fijos para compartir por WhatsApp
Â  Â  Â  Â  const REVIEW_URL = 'https://g.page/r/Cag5XmHF8-QOEAE/review';
Â  Â  Â  Â  const CUIDADOS_URL = 'https://darkone.cl/cuidados/';

Â  Â  Â  Â  // Enlace con formato enlace corto (Se asume que los links de forms.gle ya son cortos)
Â  Â  Â  Â  const getFormLink = (url) => url;


Â  Â  Â  Â  // --- DEFINICIÃ“N DE TEXTOS LARGOS CON FORMATO MEJORADO (Markdown/WhatsApp) ---

Â  Â  Â  Â  const PIERCING_DETAILS = `
*INFORMACIÃ“N ESENCIAL â€“ PIERCING (DARK ONE)*
---
âš ï¸ *LECTURA Y FORMULARIO OBLIGATORIO:*
Rellene el Formulario exigido por el Ministerio de Salud para piercing aquÃ­:
âž¡ï¸ ${getFormLink('https://forms.gle/z4opFbEPE3Q5h72B8')}

*RESERVA, PAGO Y CONDICIONES*
* Solo para mayores de *18 aÃ±os*.
* El *Abono no es reembolsable*.
* *Puntualidad:* Si llega tarde, el tiempo perdido podrÃ­a requerir agendar con otro abono.
* *Cambios:* Avise con *24 horas* de anticipaciÃ³n.
* *DuraciÃ³n:* 30 minutos (aproximadamente).
* *GiftCard:* Se descuentan *$15.000* del monto como adelanto.

*PREPARACIÃ“N Y SALUD*
* Asista sin maquillaje, cremas ni lesiones en la zona.
* *Coma e hidrÃ¡tese* antes. *NO* consuma alcohol ni aspirinas *24 horas* antes.
* *AVISAR* si padece o consume: Alergias, hemofilia, diabetes, hipertensiÃ³n, enfermedad autoinmune, anticoagulantes.

*ACOMPAÃ‘ANTES, GARANTÃA Y RIESGOS*
* Los acompaÃ±antes esperan *fuera* de la sala de procedimientos. *No* asistir con niÃ±os.
* *GarantÃ­a y Controles:* Incluye *1 control gratuito* a los 30 dÃ­as. Si no asiste, perderÃ¡ su garantÃ­a.
* *Riesgos:* Estos aumentan si no sigue los cuidados indicados.
* En caso de complicaciones, dÃ© aviso inmediato.

ðŸ”— *CUIDADOS Y GARANTÃA DETALLADOS:* ${getFormLink(CUIDADOS_URL)}
Productos de la mÃ¡s alta calidad â€“ DARK ONE / DARK CANDLES & SANTIAGO INK TATUAJESÂ® Desde 2010
Â  Â  Â  Â  `.trim();

Â  Â  Â  Â  const TATUAJE_DETAILS = `
*INFORMACIÃ“N ESENCIAL â€“ TATUAJES (DARK ONE)*
---
âš ï¸ *LECTURA Y FORMULARIO OBLIGATORIO:*
Rellene el Formulario exigido por el Ministerio de Salud para tatuajes aquÃ­:
âž¡ï¸ ${getFormLink('https://forms.gle/ksEmp5LmUzeCKvs39')}

*RESERVA, PAGO Y CONDICIONES*
* Solo para *mayores de edad*.
* Las citas incluyen tiempo para montaje, revisiÃ³n y modificaciones parciales.
* Los *Abonos no son reembolsables*.
* *Puntualidad:* Si llega tarde, pierde tiempo; si no asiste, pierde el abono.
* *Cambios:* Avise con *24 horas* de anticipaciÃ³n.
* *Reservas con GiftCard:* Se consideran *$25.000* como abono de reserva.

*PREPARACIÃ“N Y SALUD*
* Use *ropa cÃ³moda*. Se recomienda llegar con la zona *depilada*.
* *Coma e hidrÃ¡tese* al menos 2 horas antes. *NO* consuma alcohol ni aspirinas *24 horas* antes.
* *AVISAR* si padece o consume: Alergias, hemofilia, diabetes, epilepsia, hipertensiÃ³n, ansiedad, anticoagulantes.

*CONSEJOS Y CUIDADOS POSTERIORES*
* Evite acompaÃ±antes.
* *NO* recomendamos bephantol.
* *Riesgos:* Existen riesgos si no sigue los cuidados.
* *Complicaciones:* DÃ© aviso al estudio (+56932237670) y asista a un centro mÃ©dico.

ðŸ”— *CUIDADOS Y GARANTÃA DETALLADOS:* ${getFormLink(CUIDADOS_URL)}
Productos de primera calidad. DARK ONE es marca registrada de SANTIAGO INK TATUAJES & DARK CANDLES Â®. Desde 2010.
Â  Â  Â  Â  `.trim();

Â  Â  Â  Â  const GRANULOMA_DETAILS = `
*INFORMACIÃ“N ESENCIAL â€“ TRATAMIENTO DE GRANULOMAS (DARK ONE)*
---
âš ï¸ *LECTURA OBLIGATORIA*
(No requiere formulario de salud en este caso).

*RESERVA, PAGO Y TRATAMIENTO*
* Solo para mayores de *18 aÃ±os*.
* Las sesiones son cada *una semana* y cada sesiÃ³n se abona por adelantado.
* El *Abono no es reembolsable*.
* *Puntualidad:* Si llega tarde, se pierde el tiempo asignado.
* *Cambios:* Avise con *24 horas* de anticipaciÃ³n.
* *Importante:* No podemos asegurar el nÃºmero total de sesiones.

*PREPARACIÃ“N Y SALUD*
* Asista sin cremas ni maquillaje.
* *Coma e hidrÃ¡tese* antes. *NO* consumas alcohol ni aspirinas *24 horas* antes.
* *AVISAR* si padece o consume: Alergias, hemofilia, diabetes, hipertensiÃ³n, ansiedad, anticoagulantes.

*CONSEJOS Y RIESGOS*
* Evite acompaÃ±antes en la sala.
* *Riesgos:* Existen riesgos de reacciones dÃ©rmicas si no sigue los cuidados.
* En caso de complicaciones, dÃ© aviso inmediato a Dark One y asista a un centro mÃ©dico.

Productos de la mÃ¡s alta calidad â€“ DARK ONE / DARK CANDLES & SANTIAGO INK TATUAJESÂ® Desde 2010.
Â  Â  Â  Â  `.trim();

Â  Â  Â  Â  const PIERCING_MENOR_DETAILS = `
*INFORMACIÃ“N ESENCIAL â€“ PIERCING MENOR DE EDAD (DARK ONE)*
---
âš ï¸ *LECTURA Y DOBLE FORMULARIO OBLIGATORIO:*
Complete los *DOS* formularios con los datos del menor:
âž¡ï¸ ${getFormLink('https://forms.gle/AtkD8w2YeDfUWhyW6')}
âž¡ï¸ ${getFormLink('https://forms.gle/z4opFbEPE3Q5h72B8')}

*RESERVA, PAGO Y CONDICIONES*
* El *Abono no es reembolsable*.
* *Puntualidad:* Si llega tarde, el tiempo perdido podrÃ­a requerir agendar con otro abono.
* *Cambios:* Avise con *24 horas* de anticipaciÃ³n.
* *GiftCard:* Se descuentan *$15.000* como adelanto.

*TUTOR, ACOMPAÃ‘ANTES Y GARANTÃA*
* El *tutor* es el Ãºnico que debe acompaÃ±ar al menor.
* *Controles:* Incluye *1 control gratuito* al mes (de lunes a viernes). Si no asiste, pierde la garantÃ­a.

*PREPARACIÃ“N Y CUIDADOS*
* Asista sin cremas ni maquillaje.
* *Coma e hidrÃ¡tese* antes. *NO* consuma alcohol ni aspirinas *24 horas* antes.
* *Informar:* Avise sobre alergias, hemofilia, diabetes o sÃ­ntomas respiratorios.
* *Cuidados:* Revise los cuidados en: ${getFormLink(CUIDADOS_URL)}

Productos de la mÃ¡s alta calidad â€“ DARK ONE / DARK CANDLES & SANTIAGO INK TATUAJESÂ® Desde 2010
Â  Â  Â  Â  `.trim();

Â  Â  Â  Â  const RETOQUES_DETAILS = `
*INFORMACIÃ“N ESENCIAL â€“ RESERVA DE RETOQUES (DARK ONE)*
---
(No requiere formulario de salud en este caso).

*RESERVA Y CONDICIONES DE GARANTÃA*
* *Cambios:* Debe avisar con *48 horas* de anticipaciÃ³n. De lo contrario, pierde la posibilidad de reagendar *sin costo*.
* *Puntualidad:* Si llega tarde, perderÃ¡ tiempo. Si *no asiste*, pierde la garantÃ­a y la opciÃ³n de reagendar sin costo.

*VALORES ADICIONALES (Reagendas y Extras)*
* *Reagendar / Extra (Negro):* Costo mÃ­nimo adicional de *$15.000*.
* *Reagendar / Extra (Color):* Costo mÃ­nimo adicional de *$25.000*.
* Si no asiste, pierde el adicional depositado.

*PREPARACIÃ“N Y CONSEJOS*
* Sea *puntual*.
* Use *ropa cÃ³moda* y llegue con la zona *depilada*.
* *Coma e hidrÃ¡tese* al menos 2 horas antes. Evite destilados y aspirina 24 horas antes.
* *NO* recomendamos bephantol para el cuidado.

ðŸ”— *CUIDADOS Y GARANTÃA DETALLADOS:* ${getFormLink(CUIDADOS_URL)}
Productos de primera calidad. DARK ONE es marca registrada de SANTIAGO INK TATUAJES & DARK CANDLES Â®. Desde 2010.
Â  Â  Â  Â  `.trim();

Â  Â  Â  Â  const SERVICE_CONTENT = {
Â  Â  Â  Â  Â  Â  'Tatuaje': { details: TATUAJE_DETAILS },
Â  Â  Â  Â  Â  Â  'Piercing': { details: PIERCING_DETAILS },
Â  Â  Â  Â  Â  Â  'Tratamiento Granuloma': { details: GRANULOMA_DETAILS },
Â  Â  Â  Â  Â  Â  'Piercing Menor de Edad': { details: PIERCING_MENOR_DETAILS },
Â  Â  Â  Â  Â  Â  'Reserva de Retoques': { details: RETOQUES_DETAILS },
Â  Â  Â  Â  };


Â  Â  Â  Â  // --- UTILIDADES Y CONFIGURACIÃ“N INICIAL ---

Â  Â  Â  Â  const formatDate = (dateStr) => {
Â  Â  Â  Â  Â  Â  if (!dateStr) return '';
Â  Â  Â  Â  Â  Â  const [year, month, day] = dateStr.split('-');
Â  Â  Â  Â  Â  Â  return `${day}/${month}/${year}`;
Â  Â  Â  Â  };

Â  Â  Â  Â  const getTodayDate = () => {
Â  Â  Â  Â  Â  Â  const now = new Date();Â 
Â  Â  Â  Â  Â  Â  const year = now.getFullYear();
Â  Â  Â  Â  Â  Â  const month = String(now.getMonth() + 1).padStart(2, '0');
Â  Â  Â  Â  Â  Â  const day = String(now.getDate()).padStart(2, '0');
Â  Â  Â  Â  Â  Â  return `${year}-${month}-${day}`;
Â  Â  Â  Â  };

Â  Â  Â  Â  const calculateDefaultEndTime = (startTime) => {
Â  Â  Â  Â  Â  Â  if (!startTime) return '';Â 
Â  Â  Â  Â  Â  Â  let [hours, minutes] = startTime.split(':').map(Number);
Â  Â  Â  Â  Â  Â  minutes += 30; // 30 minutos de duraciÃ³n por defecto
Â  Â  Â  Â  Â  Â  if (minutes >= 60) {
Â  Â  Â  Â  Â  Â  Â  Â  hours = (hours + 1) % 24;Â 
Â  Â  Â  Â  Â  Â  Â  Â  minutes -= 60;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
Â  Â  Â  Â  };

Â  Â  Â  Â  // Inicializar los campos de Fecha y Hora con los valores por defecto
Â  Â  Â  Â  const initialDate = getTodayDate();
Â  Â  Â  Â  const initialStartTime = '15:00';Â 
Â  Â  Â  Â  const initialEndTime = calculateDefaultEndTime(initialStartTime);

Â  Â  Â  Â  // Se inicializan los valores al cargar la pÃ¡gina.
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  $('appointmentDate').value = initialDate;
Â  Â  Â  Â  Â  Â  $('appointmentStartTime').value = initialStartTime;
Â  Â  Â  Â  Â  Â  $('appointmentEndTime').value = initialEndTime;

Â  Â  Â  Â  Â  Â  // Escucha el cambio de hora de inicio para actualizar hora de tÃ©rmino (+30 min)
Â  Â  Â  Â  Â  Â  $('appointmentStartTime').addEventListener('input', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  $('appointmentEndTime').value = calculateDefaultEndTime(e.target.value);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â // Asigna la funciÃ³n de generaciÃ³n al formulario
Â  Â  Â  Â  Â  Â  $('appointmentForm').addEventListener('submit', generateSummary);
Â  Â  Â  Â  });

Â  Â  Â  Â  const formatCalendarTimeLocal = (date, time) => {
Â  Â  Â  Â  Â  Â  // Formato YYYYMMDDTHHMMSS sin Z para que Google use la hora local del usuario
Â  Â  Â  Â  Â  Â  const [year, month, day] = date.split('-');
Â  Â  Â  Â  Â  Â  const [hour, minute] = time.split(':');
Â  Â  Â  Â  Â  Â  return `${year}${month}${day}T${hour}${minute}00`;
Â  Â  Â  Â  };

Â  Â  Â  Â  function copyToClipboard(elementId, fieldName) {
Â  Â  Â  Â  Â  Â  const element = $(elementId);
Â  Â  Â  Â  Â  Â  const textToCopy = element.value || element.textContent;Â 
Â  Â  Â  Â  Â  Â  const statusDiv = $('statusMessage');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  statusDiv.classList.remove('hidden', 'bg-red-600', 'text-white', 'bg-amber-500', 'text-gray-900', 'bg-purple-500');
Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const tempTextArea = document.createElement('textarea');
Â  Â  Â  Â  Â  Â  Â  Â  tempTextArea.value = textToCopy;
Â  Â  Â  Â  Â  Â  Â  Â  tempTextArea.style.position = 'absolute';
Â  Â  Â  Â  Â  Â  Â  Â  tempTextArea.style.left = '-9999px';
Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(tempTextArea);
Â  Â  Â  Â  Â  Â  Â  Â  tempTextArea.select();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const success = document.execCommand('copy');
Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(tempTextArea);

Â  Â  Â  Â  Â  Â  Â  Â  if (success) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.classList.add('bg-[#e11d48]', 'text-white'); // Ã‰xito en Rojo Magenta
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-medium">Â¡${fieldName} copiado al portapapeles!</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.classList.add('bg-red-600', 'text-white');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-medium">Error al copiar. Por favor, intente seleccionar el texto.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.classList.add('bg-red-600', 'text-white');
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-medium">Error interno de copia. Por favor, hazlo manualmente.</p>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  statusDiv.classList.remove('hidden');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.classList.add('hidden');
Â  Â  Â  Â  Â  Â  }, 5000);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function generateSummary(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  // 1. Obtener valores
Â  Â  Â  Â  Â  Â  const clientName = $('clientName').value.trim();
Â  Â  Â  Â  Â  Â  const serviceType = $('serviceType').value;Â 
Â  Â  Â  Â  Â  Â  const serviceName = serviceType;
Â  Â  Â  Â  Â  Â  const appointmentDate = $('appointmentDate').value;Â 
Â  Â  Â  Â  Â  Â  const appointmentStartTime = $('appointmentStartTime').value;
Â  Â  Â  Â  Â  Â  const appointmentEndTime = $('appointmentEndTime').value;
Â  Â  Â  Â  Â  Â  const abono = parseInt($('abono').value) || 0;Â 
Â  Â  Â  Â  Â  Â  const manualDescription = $('description').value.trim(); // <-- Variable con las notas
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let clientEmail = $('clientEmail').value.trim();
Â  Â  Â  Â  Â  Â  if (clientEmail.indexOf('@') === -1 && clientEmail.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â clientEmail = clientEmail + '@gmail.com'; // AÃ±ade el dominio si falta
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let clientPhone = $('clientPhone').value.trim();Â 

Â  Â  Â  Â  Â  Â  // 2. Validar que la informaciÃ³n requerida existe
Â  Â  Â  Â  Â  Â  Â if (!clientName || !clientEmail || !appointmentDate || !appointmentStartTime || !appointmentEndTime || !clientPhone || clientPhone.length < 10) {
Â  Â  Â  Â  Â  Â  Â  Â  Â const errorText = (!clientPhone || clientPhone.length < 10) ? 'Faltan campos obligatorios o el nÃºmero de WhatsApp es demasiado corto (debe incluir +569...)' : 'Faltan campos obligatorios por rellenar.';
Â  Â  Â  Â  Â  Â  Â  Â  Â const statusDiv = $('statusMessage');
Â  Â  Â  Â  Â  Â  Â  Â  Â statusDiv.classList.remove('hidden', 'bg-amber-500', 'text-gray-900', 'bg-purple-500');
Â  Â  Â  Â  Â  Â  Â  Â  Â statusDiv.classList.add('bg-red-600', 'text-white');
Â  Â  Â  Â  Â  Â  Â  Â  Â statusDiv.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg><p class="text-sm font-medium">${errorText}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â setTimeout(() => { statusDiv.classList.add('hidden'); }, 5000);
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  Â }

Â  Â  Â  Â  Â  Â  // 3. Normalizar el telÃ©fono para wa.me (quitando el +)
Â  Â  Â  Â  Â  Â  let normalizedPhone = clientPhone.replace(/[^0-9+]/g, '');
Â  Â  Â  Â  Â  Â  if (!normalizedPhone.startsWith('+')) {
Â  Â  Â  Â  Â  Â  Â  Â  normalizedPhone = '+' + normalizedPhone;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const phoneForWhatsapp = normalizedPhone.substring(1);Â 

Â  Â  Â  Â  Â  Â  // 4. Cargar Contenido Condicional (Texto largo formateado)
Â  Â  Â  Â  Â  Â  const content = SERVICE_CONTENT[serviceType] || SERVICE_CONTENT['Piercing'];Â 
Â  Â  Â  Â  Â  Â  const { details: conditionalDetails } = content;

Â  Â  Â  Â  Â  Â  // 5. Formatear Abono y Fecha
Â  Â  Â  Â  Â  Â  const abonoFormateado = abono.toLocaleString('es-CL', { style: 'currency', currency: 'CLP', minimumFractionDigits: 0 });
Â  Â  Â  Â  Â  Â  const formattedDate = formatDate(appointmentDate); // DD/MM/YYYY para display

            // --- INICIO DE CAMBIOS PARA SEPARAR CONTENIDOS ---

            // 6. Componente Reutilizable: Bloque de DATOS DE LA CITA
            const datosCitaBloque = `
*DATOS DE LA CITA*
ðŸ‘¤ *Cliente:* ${clientName}
ðŸ“§ *Correo:* ${clientEmail}
ðŸ“± *TelÃ©fono:* ${clientPhone} 
ðŸ’‰ *Servicio:* ${serviceName}
ðŸ—“ï¸ *Fecha:* *${formattedDate}*
â° *Horario:* *${appointmentStartTime} a ${appointmentEndTime}*
ðŸ“ *Lugar:* ${CALENDAR_LOCATION}
ðŸ’µ *Abono:* *${abonoFormateado}* (Para asegurar el cupo)

${manualDescription ? `ðŸ“ *Notas de Servicio:* ${manualDescription}\n` : ''}`.trim();

            const condicionesBloque = conditionalDetails;
            
            // 7. GeneraciÃ³n del Mensaje de WhatsApp (ORDEN: DATOS -> CONDICIONES)
            const whatsappText = `
*âœ¨ Â¡Gracias por preferirnos, ${clientName}! Tu cita estÃ¡ confirmada: âœ¨*
---
${datosCitaBloque}
---
${condicionesBloque}
            `.trim();

            // 8. GeneraciÃ³n del Mensaje de Calendar (ORDEN: CONDICIONES -> DATOS)
            const calendarDescriptionText = `
*âœ¨ Â¡Gracias por preferirnos, ${clientName}! Tu cita estÃ¡ confirmada: âœ¨*
---
${condicionesBloque}
---
${datosCitaBloque}
            `.trim();

            // --- FIN DE CAMBIOS PARA SEPARAR CONTENIDOS ---

Â  Â  Â  Â  Â  Â  // 9. Determinar Calendar Source ID (SRC)
Â  Â  Â  Â  Â  Â  let ownerCalendarSrc;
Â  Â  Â  Â  Â  Â  let calendarTargetName;

Â  Â  Â  Â  Â  Â  if (serviceType === 'Tatuaje' || serviceType === 'Reserva de Retoques') {
Â  Â  Â  Â  Â  Â  Â  Â  ownerCalendarSrc = TATUAJE_CALENDAR_SRC;
Â  Â  Â  Â  Â  Â  Â  Â  calendarTargetName = 'Citas WEB Tatuajes';Â 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  ownerCalendarSrc = PIERCING_CALENDAR_SRC;
Â  Â  Â  Â  Â  Â  Â  Â  calendarTargetName = 'Citas WEB Piercing';Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  $('calendarTargetName').textContent = calendarTargetName;Â 

Â  Â  Â  Â  Â  Â  // 10. Preparar URL de Calendar
Â  Â  Â  Â  Â  Â  const startCalendarTime = formatCalendarTimeLocal(appointmentDate, appointmentStartTime);
Â  Â  Â  Â  Â  Â  const endCalendarTime = formatCalendarTimeLocal(appointmentDate, appointmentEndTime);
Â  Â  Â  Â  Â  Â  const remindersParam = `&reminders=[{"method":"popup","minutes":${REMINDER_MINUTES}}]`;
            
Â  Â  Â  Â  Â  Â  // El tÃ­tulo sigue igual (Servicio | Cliente (Notas) | Abono)
Â  Â  Â  Â  Â  Â  const calendarTitle = `${serviceType} | ${clientName}${manualDescription ? ` (${manualDescription})` : ''} | Abono ${abonoFormateado}`;
            
Â  Â  Â  Â  Â  Â  // Limpieza del texto para el parÃ¡metro 'details' (DescripciÃ³n de Calendar)
Â  Â  Â  Â  Â  Â  const calendarDetailsCleaned = calendarDescriptionText // <-- Usamos la nueva variable aquÃ­
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\*/g, '')Â 
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/---/g, '\n-----\n')Â 
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/âž¡ï¸/g, '->')Â 
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/[\u2700-\u27BF\uE000-\uF8FF\u2000-\u206F\u2C00-\u2C5F\uFF00-\uFFEF]/g, '');Â 

Â  Â  Â  Â  Â  Â  // 11. ConstrucciÃ³n final del enlace a Google Calendar
Â  Â  Â  Â  Â  Â  const calendarUrl = `https://calendar.google.com/calendar/r/eventedit?text=${encodeURIComponent(calendarTitle)}&dates=${startCalendarTime}/${endCalendarTime}&details=${encodeURIComponent(calendarDetailsCleaned)}&location=${encodeURIComponent(CALENDAR_LOCATION)}&ctz=${TIMEZONE_CTZ}&src=${encodeURIComponent(ownerCalendarSrc)}&hl=es${remindersParam}&add=${encodeURIComponent(clientEmail)}`; // <--- CAMBIO APLICADO: Agregado '&add=clientEmail'

Â  Â  Â  Â  Â  Â  // 12. ConstrucciÃ³n del enlace de WhatsApp
Â  Â  Â  Â  Â  Â  const whatsappEncodedText = encodeURIComponent(whatsappText); // <-- Usamos la nueva variable aquÃ­
Â  Â  Â  Â  Â  Â  const whatsappUrl = `https://wa.me/${phoneForWhatsapp}?text=${whatsappEncodedText}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 13. Mostrar resultados en la interfaz
Â  Â  Â  Â  Â  Â  $('resumenTexto').textContent = whatsappText; // Mensaje de vista previa usa el texto de WhatsApp
Â  Â  Â  Â  Â  Â  $('whatsappLink').href = whatsappUrl;
Â  Â  Â  Â  Â  Â  $('debugUrlOutput').value = calendarUrl;
Â  Â  Â  Â  Â  Â  $('outputContainer').classList.remove('hidden');

Â  Â  Â  Â  Â  Â  // 14. Auto-copiar URL de Calendar
Â  Â  Â  Â  Â  Â  copyToClipboard('debugUrlOutput', 'URL de Calendar');

Â  Â  Â  Â  Â  Â  // Desplazarse a los resultados
Â  Â  Â  Â  Â  Â  $('outputContainer').scrollIntoView({ behavior: 'smooth' });
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>
